#!/bin/bash

apt-get install mysql-server apache2 openoffice.org php5 libapache2-mod-php5 php5-gd php5-mysql php5-imagick libimage-exiftool-perl php5-sqlite php-pear php5-dev python-uno php5-mcrypt php5-curl zip unzip imagemagick ghostscript build-essential
pecl install uploadprogress

cp /etc/php5/apache2/php.ini /etc/php5/apache2/php.ini.bak
cat <<-FIN >> /etc/php5/apache2/php.ini

# EyeOS configuration
extension=uploadprogress.so
display_errors = Off
max_execution_time = 30
max_input_time = 60
memory_limit = 128M
post_max_size = 200M
upload_max_filesize = 100M
allow_url_fopen = On
disable_functions =
safe_mode = Off
short_open_tag = On
magic_quotes_runtime = Off
file_uploads = On
# End EyeOS

FIN

cp /etc/apache2/sites-available/default /etc/apache2/sites-available/default.bak
cat <<-FIN >> /etc/apache2/sites-available/default
	<Directory '/var/www/eyeos'>
		Options -Indexes FollowSymLinks
		AllowOverride all
		Order deny,allow
		Allow from all
	</Directory>
FIN
vi /etc/apache2/sites-available/default

a2enmod rewrite

cat <<-FIN >> /tmp/sql.$$
CREATE DATABASE 'eyeos';
GRANT ALL ON 'eyeos'.* TO 'eyeos'@'localhost' IDENTIFIED BY 'eyeos';
flush privileges;
FIN

mysql -u root -e /tmp/sql.$$ -p

mkdir /tmp/eyeos.$$
cd /tmp/eyeos.$$
wget http://garr.dl.sourceforge.net/project/eyeos/eyeos2/eyeos-2.5.tar.gz
tar -xzf eyeos-2.5.tar.gz
rm eyeos-2.5.tar.gz
mv /tmp/eyeos.$$ /var/www/eyeos
chown -R www-data.www-data /var/www/eyeos
chmod -R 755 /var/www/eyeos
find -type f -exec chmod 644 {} \;

/etc/init.d/apache2 restart

